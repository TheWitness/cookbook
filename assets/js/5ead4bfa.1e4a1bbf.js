"use strict";(self.webpackChunklitesaml_docs=self.webpackChunklitesaml_docs||[]).push([[990],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},y=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),y=a,m=u["".concat(l,".").concat(y)]||u[y]||d[y]||i;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=y;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}y.displayName="MDXCreateElement"},7325:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const i={title:"Generate a key pair",sidebar_position:1},o=void 0,s={unversionedId:"security/generate-key-pair",id:"security/generate-key-pair",title:"Generate a key pair",description:"In order to use any of the SAML security features like signatures and encryption, you would first need a key pair. In consists of",source:"@site/docs/security/generate-key-pair.md",sourceDirName:"security",slug:"/security/generate-key-pair",permalink:"/docs/security/generate-key-pair",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Generate a key pair",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Security",permalink:"/docs/security/"},next:{title:"Sign message",permalink:"/docs/security/sign-message"}},l={},p=[{value:"Using key pair with Light Saml",id:"using-key-pair-with-light-saml",level:2},{value:"Inspecting generated certificate",id:"inspecting-generated-certificate",level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In order to use any of the SAML security features like signatures and encryption, you would first need a key pair. In consists of\na public part - the certificate, and a private key. Private key is used to sign SAML messages, while public key is used to encrypt\nand message, so only you can decrypt it, and to verify your signatures. Certificate is published with your SAML metadata and is freely\ndistributed to your relying parties. Private key, just as it's name says, should remain private and for your eyes only. Due to security\nissues, certificates expire after some time, and you have to renew them in order to keep SAML signing and encryption working."),(0,a.kt)("p",null,"You can generate a key pair with ",(0,a.kt)("a",{parentName:"p",href:"https://www.openssl.org/"},"OpenSSL"),". It's a complex suit with several bundled tools, but the easiest\nway is"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ openssl req -new -x509 -days 365 -nodes -sha256 -out saml.crt -keyout saml.pem\n")),(0,a.kt)("p",null,"That command line will produce two files ",(0,a.kt)("inlineCode",{parentName:"p"},"saml.crt")," - the certificate with a public key, and ",(0,a.kt)("inlineCode",{parentName:"p"},"saml.pem")," - your private key. You need\nto provide those two files to the Light Saml in order to use SAML security features."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note"),": The ",(0,a.kt)("inlineCode",{parentName:"p"},"-sha256")," switch tells OpenSSL to generate a certificate using SHA-256 digest algorithm. By default, if you omit that\nswitch, you'll get a SHA-1 digest which is considered week these days, and you should avoid it."),(0,a.kt)("h2",{id:"using-key-pair-with-light-saml"},"Using key pair with Light Saml"),(0,a.kt)("p",null,"You can load a certificate file using static method ",(0,a.kt)("inlineCode",{parentName:"p"},"fromFile")," on class ",(0,a.kt)("inlineCode",{parentName:"p"},"X509Certificate"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n$certificate = X509Certificate::fromFile('/path/to/saml.crt');\n")),(0,a.kt)("p",null,"You can load your private key using ",(0,a.kt)("inlineCode",{parentName:"p"},"KeyHelper")," class"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n$privateKey = KeyHelper::createPrivateKey('/path/to/saml.pem', '', true, XMLSecurityKey::RSA_SHA256);\n")),(0,a.kt)("p",null,"You can sign a SAML message by setting an instance of ",(0,a.kt)("inlineCode",{parentName:"p"},"SignatureWriter")," to it's signature property and serializing it afterwards."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n$message->setSignature(SignatureWriter::createByKeyAndCertificate($certificate, $privateKey));\n$context = new SerializationContext();\n$message->serialize($context->getDocument(), $context);\n")),(0,a.kt)("p",null,"For details about signing look at ",(0,a.kt)("a",{parentName:"p",href:"sign-message"},"How to sign a SAML message")," cookbook article."),(0,a.kt)("h2",{id:"inspecting-generated-certificate"},"Inspecting generated certificate"),(0,a.kt)("p",null,"Once generated certificate can be inspected with following command line"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ openssl x509 -in saml.crt -text -noout\n")),(0,a.kt)("p",null,"Important things to look for are following"),(0,a.kt)("p",null,"Digest algorithm used"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Signature Algorithm: sha256WithRSAEncryption\n")),(0,a.kt)("p",null,"Issuer"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Issuer: C=AU, ST=Some-State, O=Internet Widgits Pty Ltd, CN=common name\n")),(0,a.kt)("p",null,"And validity dates"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Validity\n    Not Before: Aug  9 07:04:20 2016 GMT\n    Not After : Aug  9 07:04:20 2017 GMT\n")))}u.isMDXComponent=!0}}]);